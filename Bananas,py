import pygame

pygame.image.load("monke\\walk\\Monke Walk 1.png")

def center_frames(frames, mode='bottom'):
    frame_dimens = [f.get_size() for f in frames]
    x_max, y_max = max(frame_dimens, key=lambda x: x[0])[0], max(frame_dimens, key=lambda x: x[1])[1]
    print(x_max, y_max)
    centered_frames = []
    
    if mode == 'bottom':
        for frame in frames:
            surf = pygame.Surface((x_max, y_max), pygame.SRCALPHA)
            rect = surf.get_rect()
            rect.midbottom = x_max//2, y_max
            surf.blit(frame, rect)
            centered_frames.append(surf)
    
    return centered_frames

class Goril:
    walk_right = center_frames([pygame.image.load(f"monke\\walk\\Monke Walk {i}.png") for i in range(1, 9)])
    walk_left = [pygame.transform.flip(frame, 1, 0) for frame in walk_right]
    walk_anim_time = 125
    walk_speed = 0.25

    def __init__(self, screen):
        self.t = 0
        self.vel_x, self.vel_y = 0, 0
        self.x, self.y = 0, 0
        self.x_max, self.y_max = screen.get_size()

        self.walk_rect = self.walk_right[0].get_rect()
        self.rect = self.walk_rect
        self.sprite = self.walk_right[0]
        self.anim_time = self.walk_anim_time
        self.anim_index = 0
        self.switch_frame_at = self.t + self.anim_time
                
        self.gravity = 0.005
        self.facing = 'right'
        self.moving = False
    
        
    def update(self, dt, floor = 800):
        # Gravity:
        self.t += dt
        
        if self.y >= floor and self.vel_y > 0: 
            self.vel_y = 0
        else: self.vel_y = self.vel_y+self.gravity*dt 
        self.y = min(floor, self.y+self.vel_y*dt)
        self.rect.midbottom = self.x, self.y
        
        self.move(dt)

    def draw(self, screen):
        screen.blit(self.sprite, self.rect)
    
    def move(self, dt):
        if self.moving:
            if self.facing == 'left': 
                self.x = max(self.x-self.walk_speed*dt, 0)
            else: 
                self.x = min(self.x+self.walk_speed*dt, self.x_max)
            
            if self.t > self.switch_frame_at:
                self.switch_frame_at += self.walk_anim_time
                self.anim_index = (self.anim_index + 1) % len(self.walk_left)
                self.sprite = self.walk_left[self.anim_index] if self.facing == 'left' else self.walk_right[self.anim_index]

    def stop_moving(self):
        self.moving = False
    
    def jump(self):
        self.vel_y -= 2
    
    def set_next_anim_time(self):
        self.switch_frame_at = self.t 



if __name__ == '__main__':
    FPS = 60
    screen = pygame.display.set_mode((1000, 850))
    clock = pygame.time.Clock()
    
    goril = Goril(screen)
    run = True
    while run:
        dt = clock.tick(FPS)
        
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                run = False
            
            elif event.type == pygame.KEYDOWN:
                if event.key == pygame.K_d:
                    goril.set_next_anim_time()
                    goril.moving = True
                    goril.facing = 'right'
                elif event.key == pygame.K_a:
                    goril.set_next_anim_time()
                    goril.moving = True
                    goril.facing = 'left'
                
                elif event.key == pygame.K_SPACE:
                    goril.jump()
            
            elif event.type == pygame.KEYUP:
                if event.key == pygame.K_d:
                    goril.stop_moving()
                elif event.key == pygame.K_a:
                    goril.stop_moving()

        screen.fill((30, 30, 30))
        goril.update(dt if dt != 0 else 1/FPS)
        goril.draw(screen)
        
        
        pygame.display.update()

    
    pygame.quit()